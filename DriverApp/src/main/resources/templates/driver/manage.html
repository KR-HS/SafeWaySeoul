<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{/include/headerbaseLayout}"/>
    <title>승하차관리페이지</title>
    <link rel="stylesheet" href="/css/driver/manage.css">
    <script src="/js/driver/manage.js"></script>
</head>
<body>
<th:block th:replace="~{/include/baseLayout :: setContent(~{ :: .app-content})}">

    <section class="app-content">
        <div class="content-header">
            <div class="backBtn"><img src="/img/back.png" alt="뒤로가기"></div>
            <div class="header-comment-wrap">
                <p class="header-mainComment">승하차관리</p>
                <p class="header-subComment">동대문구 1노선</p>
            </div>
        </div>

        <!--지도 부분-->
        <div id="map">

        </div>

        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=	8997d782f5298e9e818dbcbf6a5ab396&libraries=services"></script>

        <style>
            /* InfoWindow 스타일 */
            .info-window {
                padding: 15px;
                font-size: 14px;
                line-height: 1.5;
                color: #333;
                background-color: #fff;
                border-radius: 5px;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
                width: 250px;
            }
            .info-window strong {
                font-size: 16px;
                color: #555;
            }
            .info-window a {
                color: #007aff;
                text-decoration: none;
            }
            .info-window a:hover {
                text-decoration: underline;
            }
            .info-window .address {
                margin: 5px 0;
                font-size: 12px;
                color: #666;
            }
            .info-window .phone {
                font-size: 12px;
                color: #666;
            }

        </style>
        <script>
            // 카카오맵 로드후 실행
            kakao.maps.load(function () {
                //마커 좌표들
                var locations = [
                    {lat: 37.5665, lng: 126.9780}
                    ,{ lat: 37.5651, lng: 126.9895 }
                    ,{ lat: 37.5700, lng: 126.9820 }
                ];

                // 이 코드는 script 태그 밑에 바로 두세요!
                var container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
                var options = { //지도를 생성할 때 필요한 기본 옵션
                    center: new kakao.maps.LatLng(37.5665, 126.9780), //지도의 중심좌표.
                    level: 9 //지도의 레벨(확대, 축소 정도)
                };

                var map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴

                // --------------지도 확대 축소 기능-------------
                // 지도 확대 축소를 제어할 수 있는  줌 컨트롤을 생성합니다
                var zoomControl = new kakao.maps.ZoomControl();
                map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

                // // 지도가 확대 또는 축소되면 마지막 파라미터로 넘어온 함수를 호출하도록 이벤트를 등록합니다
                // kakao.maps.event.addListener(map, 'zoom_changed', function() {
                //
                //     // 지도의 현재 레벨을 얻어옵니다
                //     var level = map.getLevel();
                //
                //     var message = '현재 지도 레벨은 ' + level + ' 입니다';
                //     var resultDiv = document.getElementById('result');
                //     resultDiv.innerHTML = message;
                //
                // });

                // 마커 찍고 해당 마커 클릭시 해당 정보 뜨는 기능
                const places = new kakao.maps.services.Places();

                // 열린 정보창을 추적할 변수
                let currentInfoWindow = null;

                locations.forEach(loc => {
                    const markerPosition = new kakao.maps.LatLng(loc.lat, loc.lng);

                    const marker = new kakao.maps.Marker({
                        map: map,
                        position: markerPosition
                    });

                    // 해당 좌표 근처에서 가장 가까운 장소를 검색
                    places.keywordSearch('식당', function (result, status) {
                        if (status === kakao.maps.services.Status.OK && result.length > 0) {
                            var place = result[0]; // 가장 가까운 장소

                            const content = `
                            <div class="info-window">
                                <strong>${place.place_name}</strong><br>
                                <div class="address">📍 ${place.road_address_name || place.address_name}</div>
                                <div class="phone">☎ ${place.phone}</div>
                                <a href="${place.place_url}" target="_blank">카카오맵에서 보기</a>
                            </div>
                            `;

                            const infowindow = new kakao.maps.InfoWindow({
                                content: content,
                                removable: true
                            });


                            // 마커 클릭 시, 이전에 열린 정보창을 닫고 새로운 정보창을 엽니다
                            kakao.maps.event.addListener(marker, 'click', function () {
                                // 이전 정보창이 열려 있다면 닫기
                                if (currentInfoWindow) {
                                    currentInfoWindow.close();
                                }
                                // 새로운 정보창 열기
                                infowindow.open(map, marker);
                                // 열린 정보창 추적
                                currentInfoWindow = infowindow;
                            });
                        }
                    }, {
                        location: markerPosition,
                        radius: 100,      // 반경 100m 내 검색
                        sort: 'distance'  // 거리순
                    });
                });
            });

        </script>

        <!--승하차관련-->
        <div class="children-list">
            <div class="boarding-status">3명 남음 - 1명 완료</div>

            <div class="list-card">
                <div class="list-box">
                    <div class="list-img">
                        <img src="/img/child.png" alt="아이사진">
                    </div>
                    <div class="list-content">
                        <div>홍길동(5세)</div>
                        <div>동대문구 답십리 1동</div>
                        <div>하차 시간 --:-- </div>
                    </div>
                    <div class="list-time done">하차 완료</div>
                </div>
            </div>
            <div class="list-card">
                <div class="list-box">
                    <div class="list-img">
                        <img src="/img/child.png" alt="아이사진">
                    </div>
                    <div class="list-content">
                        <div>홍길자(4세)</div>
                        <div>동대문구 답십리 2동</div>
                        <div>하차 시간 --:-- </div>
                    </div>
                    <div class="list-time">하차</div>
                </div>
            </div>
            <div class="list-card">
                <div class="list-box">
                    <div class="list-img">
                        <img src="/img/child.png" alt="아이사진">
                    </div>
                    <div class="list-content">
                        <div>홍길동(5세)</div>
                        <div>동대문구 답십리 1동</div>
                        <div>하차 시간 --:-- </div>
                    </div>
                    <div class="list-time done">하차 완료</div>
                </div>
            </div>
            <div class="list-card">
                <div class="list-box">
                    <div class="list-img">
                        <img src="/img/child.png" alt="아이사진">
                    </div>
                    <div class="list-content">
                        <div>홍길자(4세)</div>
                        <div>동대문구 답십리 2동</div>
                        <div>하차 시간 --:-- </div>
                    </div>
                    <div class="list-time">하차   </div>
                </div>
            </div>

            <script>

                $(function() {  /*js의 document.ready 이벤트*/
                    function updateBoardingStatus() {
                        var total = $('.list-time').length;
                        var done = $('.list-time.done').length;
                        var remain = total - done;
                        $('.boarding-status').text(remain + "명 남음 - " + done + "명 완료");
                    }
                    updateBoardingStatus();
                    $(document).on('click', '.list-time', function() {
                        if ($(this).hasClass('done')) return;
                        $(this).text('하차완료').addClass('done');
                        $(this).closest('.list-box').addClass('done');
                        updateBoardingStatus();
                    });
                    $(document).on('click', '.list-img', function() {
                        alert('아이상세보기');
                    });
                });

            </script>


        </div>



    </section>
</th:block>
</body>
</html>