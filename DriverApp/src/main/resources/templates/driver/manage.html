<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{/include/headerbaseLayout}"/>
    <title>ìŠ¹í•˜ì°¨ê´€ë¦¬í˜ì´ì§€</title>
    <link rel="stylesheet" href="/css/driver/manage.css">
    <script src="/js/driver/manage.js"></script>
</head>
<body>
<th:block th:replace="~{/include/baseLayout :: setContent(~{ :: .app-content})}">

    <section class="app-content">
        <div class="content-header">
            <div class="backBtn"><img src="/img/back.png" alt="ë’¤ë¡œê°€ê¸°"></div>
            <div class="header-comment-wrap">
                <p class="header-mainComment">ìŠ¹í•˜ì°¨ê´€ë¦¬</p>
                <p class="header-subComment">ë™ëŒ€ë¬¸êµ¬ 1ë…¸ì„ </p>
            </div>
        </div>

        <!--ì§€ë„ ë¶€ë¶„-->
        <div id="map">

        </div>

        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=	8997d782f5298e9e818dbcbf6a5ab396&libraries=services"></script>

        <style>
            /* InfoWindow ìŠ¤íƒ€ì¼ */
            .info-window {
                padding: 15px;
                font-size: 14px;
                line-height: 1.5;
                color: #333;
                background-color: #fff;
                border-radius: 5px;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
                width: 250px;
            }
            .info-window strong {
                font-size: 16px;
                color: #555;
            }
            .info-window a {
                color: #007aff;
                text-decoration: none;
            }
            .info-window a:hover {
                text-decoration: underline;
            }
            .info-window .address {
                margin: 5px 0;
                font-size: 12px;
                color: #666;
            }
            .info-window .phone {
                font-size: 12px;
                color: #666;
            }

        </style>
        <script>
            // ì¹´ì¹´ì˜¤ë§µ ë¡œë“œí›„ ì‹¤í–‰
            kakao.maps.load(function () {
                //ë§ˆì»¤ ì¢Œí‘œë“¤
                var locations = [
                    {lat: 37.5665, lng: 126.9780}
                    ,{ lat: 37.5651, lng: 126.9895 }
                    ,{ lat: 37.5700, lng: 126.9820 }
                ];

                // ì´ ì½”ë“œëŠ” script íƒœê·¸ ë°‘ì— ë°”ë¡œ ë‘ì„¸ìš”!
                var container = document.getElementById('map'); //ì§€ë„ë¥¼ ë‹´ì„ ì˜ì—­ì˜ DOM ë ˆí¼ëŸ°ìŠ¤
                var options = { //ì§€ë„ë¥¼ ìƒì„±í•  ë•Œ í•„ìš”í•œ ê¸°ë³¸ ì˜µì…˜
                    center: new kakao.maps.LatLng(37.5665, 126.9780), //ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ.
                    level: 9 //ì§€ë„ì˜ ë ˆë²¨(í™•ëŒ€, ì¶•ì†Œ ì •ë„)
                };

                var map = new kakao.maps.Map(container, options); //ì§€ë„ ìƒì„± ë° ê°ì²´ ë¦¬í„´

                // --------------ì§€ë„ í™•ëŒ€ ì¶•ì†Œ ê¸°ëŠ¥-------------
                // ì§€ë„ í™•ëŒ€ ì¶•ì†Œë¥¼ ì œì–´í•  ìˆ˜ ìˆëŠ”  ì¤Œ ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
                var zoomControl = new kakao.maps.ZoomControl();
                map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

                // // ì§€ë„ê°€ í™•ëŒ€ ë˜ëŠ” ì¶•ì†Œë˜ë©´ ë§ˆì§€ë§‰ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
                // kakao.maps.event.addListener(map, 'zoom_changed', function() {
                //
                //     // ì§€ë„ì˜ í˜„ì¬ ë ˆë²¨ì„ ì–»ì–´ì˜µë‹ˆë‹¤
                //     var level = map.getLevel();
                //
                //     var message = 'í˜„ì¬ ì§€ë„ ë ˆë²¨ì€ ' + level + ' ì…ë‹ˆë‹¤';
                //     var resultDiv = document.getElementById('result');
                //     resultDiv.innerHTML = message;
                //
                // });

                // ë§ˆì»¤ ì°ê³  í•´ë‹¹ ë§ˆì»¤ í´ë¦­ì‹œ í•´ë‹¹ ì •ë³´ ëœ¨ëŠ” ê¸°ëŠ¥
                const places = new kakao.maps.services.Places();

                // ì—´ë¦° ì •ë³´ì°½ì„ ì¶”ì í•  ë³€ìˆ˜
                let currentInfoWindow = null;

                locations.forEach(loc => {
                    const markerPosition = new kakao.maps.LatLng(loc.lat, loc.lng);

                    const marker = new kakao.maps.Marker({
                        map: map,
                        position: markerPosition
                    });

                    // í•´ë‹¹ ì¢Œí‘œ ê·¼ì²˜ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ ì¥ì†Œë¥¼ ê²€ìƒ‰
                    places.keywordSearch('ì‹ë‹¹', function (result, status) {
                        if (status === kakao.maps.services.Status.OK && result.length > 0) {
                            var place = result[0]; // ê°€ì¥ ê°€ê¹Œìš´ ì¥ì†Œ

                            const content = `
                            <div class="info-window">
                                <strong>${place.place_name}</strong><br>
                                <div class="address">ğŸ“ ${place.road_address_name || place.address_name}</div>
                                <div class="phone">â˜ ${place.phone}</div>
                                <a href="${place.place_url}" target="_blank">ì¹´ì¹´ì˜¤ë§µì—ì„œ ë³´ê¸°</a>
                            </div>
                            `;

                            const infowindow = new kakao.maps.InfoWindow({
                                content: content,
                                removable: true
                            });


                            // ë§ˆì»¤ í´ë¦­ ì‹œ, ì´ì „ì— ì—´ë¦° ì •ë³´ì°½ì„ ë‹«ê³  ìƒˆë¡œìš´ ì •ë³´ì°½ì„ ì—½ë‹ˆë‹¤
                            kakao.maps.event.addListener(marker, 'click', function () {
                                // ì´ì „ ì •ë³´ì°½ì´ ì—´ë ¤ ìˆë‹¤ë©´ ë‹«ê¸°
                                if (currentInfoWindow) {
                                    currentInfoWindow.close();
                                }
                                // ìƒˆë¡œìš´ ì •ë³´ì°½ ì—´ê¸°
                                infowindow.open(map, marker);
                                // ì—´ë¦° ì •ë³´ì°½ ì¶”ì 
                                currentInfoWindow = infowindow;
                            });
                        }
                    }, {
                        location: markerPosition,
                        radius: 100,      // ë°˜ê²½ 100m ë‚´ ê²€ìƒ‰
                        sort: 'distance'  // ê±°ë¦¬ìˆœ
                    });
                });
            });

        </script>

        <!--ìŠ¹í•˜ì°¨ê´€ë ¨-->
        <div class="children-list">
            <div class="boarding-status">3ëª… ë‚¨ìŒ - 1ëª… ì™„ë£Œ</div>

            <div class="list-card">
                <div class="list-box">
                    <div class="list-img">
                        <img src="/img/child.png" alt="ì•„ì´ì‚¬ì§„">
                    </div>
                    <div class="list-content">
                        <div>í™ê¸¸ë™(5ì„¸)</div>
                        <div>ë™ëŒ€ë¬¸êµ¬ ë‹µì‹­ë¦¬ 1ë™</div>
                        <div>í•˜ì°¨ ì‹œê°„ --:-- </div>
                    </div>
                    <div class="list-time done">í•˜ì°¨ ì™„ë£Œ</div>
                </div>
            </div>
            <div class="list-card">
                <div class="list-box">
                    <div class="list-img">
                        <img src="/img/child.png" alt="ì•„ì´ì‚¬ì§„">
                    </div>
                    <div class="list-content">
                        <div>í™ê¸¸ì(4ì„¸)</div>
                        <div>ë™ëŒ€ë¬¸êµ¬ ë‹µì‹­ë¦¬ 2ë™</div>
                        <div>í•˜ì°¨ ì‹œê°„ --:-- </div>
                    </div>
                    <div class="list-time">í•˜ì°¨</div>
                </div>
            </div>
            <div class="list-card">
                <div class="list-box">
                    <div class="list-img">
                        <img src="/img/child.png" alt="ì•„ì´ì‚¬ì§„">
                    </div>
                    <div class="list-content">
                        <div>í™ê¸¸ë™(5ì„¸)</div>
                        <div>ë™ëŒ€ë¬¸êµ¬ ë‹µì‹­ë¦¬ 1ë™</div>
                        <div>í•˜ì°¨ ì‹œê°„ --:-- </div>
                    </div>
                    <div class="list-time done">í•˜ì°¨ ì™„ë£Œ</div>
                </div>
            </div>
            <div class="list-card">
                <div class="list-box">
                    <div class="list-img">
                        <img src="/img/child.png" alt="ì•„ì´ì‚¬ì§„">
                    </div>
                    <div class="list-content">
                        <div>í™ê¸¸ì(4ì„¸)</div>
                        <div>ë™ëŒ€ë¬¸êµ¬ ë‹µì‹­ë¦¬ 2ë™</div>
                        <div>í•˜ì°¨ ì‹œê°„ --:-- </div>
                    </div>
                    <div class="list-time">í•˜ì°¨   </div>
                </div>
            </div>

            <script>

                $(function() {  /*jsì˜ document.ready ì´ë²¤íŠ¸*/
                    function updateBoardingStatus() {
                        var total = $('.list-time').length;
                        var done = $('.list-time.done').length;
                        var remain = total - done;
                        $('.boarding-status').text(remain + "ëª… ë‚¨ìŒ - " + done + "ëª… ì™„ë£Œ");
                    }
                    updateBoardingStatus();
                    $(document).on('click', '.list-time', function() {
                        if ($(this).hasClass('done')) return;
                        $(this).text('í•˜ì°¨ì™„ë£Œ').addClass('done');
                        $(this).closest('.list-box').addClass('done');
                        updateBoardingStatus();
                    });
                    $(document).on('click', '.list-img', function() {
                        alert('ì•„ì´ìƒì„¸ë³´ê¸°');
                    });
                });

            </script>


        </div>



    </section>
</th:block>
</body>
</html>