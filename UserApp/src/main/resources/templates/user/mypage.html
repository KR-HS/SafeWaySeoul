<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <th:block th:replace="/include/headerBaseLayout"/>
  <title>유저 자녀관리 & 마이페이지</title>
  <link rel="stylesheet" href="/css/mypage.css">
</head>
<body>

<th:block th:replace="~{/include/baseLayout :: setContent(~{ :: .app-content})}">
  <section class="app-content">

    <!-- 내 정보 -->
    <div class="user-info-section">
      <h5 class="section-title">내 정보</h5>
      <div class="user-card">
        <div class="user-image">
          <img src="/img/temp-basic-mypage-male.png" alt="내 프로필 사진">
        </div>
        <div class="user-details">
          <p class="user-name" th:text="${session.userInfo.userName}"></p>
          <p class="user-phone" th:text="${session.userInfo.userPhone}"></p>
          <p>주소</p>
          <p class="user-address" th:text="${session.userInfo.userAddress}"></p>
          <p>근무지</p>
          <p>선덕고등학교 본관 3층 교무실</p>
        </div>
      </div>
    </div>

    <!-- 우리 아이 -->
    <div class="child-info-section">
      <h5 class="section-title">우리 아이</h5>

      <!-- 자녀 리스트 -->
      <div class="child-list">
        <div class="child-card" th:each="child : ${children}">
          <div class="child-image">
            <img th:src="@{/img/temp-basic-mypage-__${child.childGender == 'F' ? 'female' : 'male'}__.png}" alt="자녀 프로필 사진">
          </div>
          <div class="child-info">
            <div class="child-name">
              <img src="/img/woman.png" alt="성별 아이콘">
              <span th:text="${child.childName}"></span>
            </div>
            <p class="child-age" th:text="${child.childBirth}"></p>
          </div>
        </div>
      </div>

      <!-- 자녀 등록 -->
      <div class="child-card child-register-box">
        <div class="register-icon-circle">
          <img src="/img/plusAddLogo.png" alt="아이 등록 버튼" class="register-icon">
        </div>
        <a href="#" class="register-link">내 아이 등록하기</a>
      </div>

    </div>
  </section>
</th:block>

<!-- 모달 영역 -->
<div id="modal-container" class="modal-hidden"></div>

<!-- 스크립트 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(function () {
    //자녀 정보가 아예 없는 경우
    if ($('.child-list .child-card').length === 0) {
      $('.child-list').hide();
      $('.child-register-box').show();
    }

    //성별 아이콘 전환
    $('.child-card').each(function () {
      var $card = $(this);
      var profileSrc = $card.find('.child-image img').attr('src');
      var isFemale = profileSrc && profileSrc.includes('female');

      if (!isFemale) {
        $card.find('.child-name img').attr('src', '/img/man.png');
      }
    });

    // 3️자녀 등록 모달창
    $('.register-icon-circle, .register-link').on('click', function(e) {
      e.preventDefault();
      $.ajax({
        url: '/regChild',
        method: 'GET',
        success: function(response) {
          $('#modal-container').html(response)
                  .removeClass('modal-hidden')
                  .addClass('modal-visible');
        },
        error: function() {
          alert('시스템 오류입니다. 안종수한테 연락주세요.');
        }
      });
    });
  });
</script>

</body>
</html>
